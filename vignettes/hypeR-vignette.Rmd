---
title: "hypeR-function-vignette"
output: rmarkdown::html_vignette
author: "Vanessa Mengze Li"
date: "May 2020"
vignette: >
  %\VignetteIndexEntry{hypeR-function-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r message=FALSE, warning=FALSE}
devtools::document()
library(reepo)
library(dplyr)
```

## hypeROverrepEnrichFunction()
`hypeROverrepEnrichFunction()` use `hypeR` package to conveniently perform gene set over-representation and rank-based gene set enrichment analysis.  

Available gene set collection are from msigDB ( http://software.broadinstitute.org/gsea/msigdb).  

The example provided below is the gene features from pyO treatment of Cal27 cell line. The gene expression result was analyzed using `lm` package.

Read in the exmaple file, and rank the gene features by score:
```{r}
testSig <- read.table("Cal27_PYO_all_features.tsv", header = T, stringsAsFactors = F)
testSig <- testSig[order(testSig$signature_score, decreasing = T), ]
head(testSig)
tail(testSig)
```

You can perform over-representation analysis using the last 100 genes, i.e. the genes significantly decreased its expression after the treatment. The gene set collection chosen here are C2 CP:KEGG and C2 CP:Reactome.
```{r}
subNegativeHundred <- testSig$signature_symbol[(length(testSig$signature_symbol) - 100):length(testSig$signature_symbol)]
gsetNames <- data.frame(
  species = "Homo sapiens",
  category = c("C2", "C2"),
  subcategory = c("CP:KEGG", "CP:REACTOME")
)
hypeROverrepEnrichFunction(subNegativeHundred, gsetNames, test = "overrep")
```

You can also get all the genes with a negative score, rank them according to the score, and perform rank-based enrichment analysis:  
```{r}
temp <- testSig[which(testSig$signature_score < 0), ]
subAllNegative <- temp$signature_symbol[order(temp$signature_score, decreasing = F)]
gsetNames <- data.frame(
  species = "Homo sapiens",
  category = c("C2"),
  subcategory = c("CP:REACTOME")
)
head(hypeROverrepEnrichFunction(subAllNegative, gsetNames, test = "enrich"))
```

You can also provide a customized gene set collection. For example, a collection downloaded from Enrichr https://amp.pharm.mssm.edu/Enrichr/#stats.  
Downloaded gene set collection can be read using `readGsetList()`. Example provided below is the aging perturbation ligand gene set collection from GEO downloaded from Enrichr website. It contains 286 gene sets.
```{r}
custGset <- readGsetList("Aging_Perturbations_from_GEO_down.txt")
head(names(custGset))
head(custGset[[1]])
```

Perform over-representation analysis using this customized gene set:
```{r}
hypeROverrepEnrichFunction(subNegativeHundred,
  gsetList = custGset,
  gsetListCategory = "GEO", gsetListSubCategory = "Aging",
  test = "overrep"
)
```

You can also provide both a datafram of `gsetNames` for msigDB and a customized gene set collection. Example omitted here.

## hypeROverrepEnrichServerFunction()
`hypeROverrepEnrichServerFunction()` sources `hypeROverrepEnrichFunction()` described above. But it is more convenient to use.  
For example, you can input our testSig dataframe use KEGG gene set collection to perform rank-based enrichment analysis as you did before. But in stead of manually grouping the features according to "+" or "-" and rank them by score, this function will take care of these automatically:
```{r}
gsetNames <- data.frame(
  species = "Homo sapiens",
  category = c("C2"),
  subcategory = c("CP:KEGG")
)
result <- hypeROverrepEnrichServerFunction(testSig, gsetNames, test = "enrich")
head(result$result)
```

Same as `hypeROverrepEnrichFunction()`, you can provide customized gene set collection. Example omitted here.


